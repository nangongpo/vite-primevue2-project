{"version":3,"file":"Login-CrtmsgOB.js","sources":["../../src/views/pages/Login.vue"],"sourcesContent":["<template>\n  <body class=\"login-body\">\n    <div class=\"mobile-banner\">\n      <Logo label=\"\" style=\"height: 48px\" />\n    </div>\n    <div class=\"login-panel\">\n      <Logo label=\"\" style=\"height: 48px\" />\n    </div>\n    <div class=\"login-card\">\n      <div class=\"top-border\" />\n      <ValidationObserver ref=\"observer\" v-slot=\"{ handleSubmit }\">\n        <form @submit.prevent=\"handleSubmit(handleLogin)\" class=\"login-content\">\n          <h1>登录</h1>\n          <p>欢迎使用{{ settings.title }}系统</p>\n          <ValidationProvider tag=\"div\" rules=\"required\" name=\"loginForm.username\" class=\"username-container\" v-slot=\"{ errors }\">\n            <label>用户名</label>\n            <div class=\"login-input\">\n              <InputText v-model=\"loginForm.username\" placeholder=\"请输入用户名\" />\n              <small class=\"p-invalid\">{{ errors[0] }}</small>\n            </div>\n          </ValidationProvider>\n          <ValidationProvider tag=\"div\" rules=\"required\" name=\"loginForm.password\" class=\"password-container\" v-slot=\"{ errors }\" >\n            <label>密码</label>\n            <div class=\"login-input\">\n              <InputText v-model=\"loginForm.password\" type=\"password\" placeholder=\"请输入密码\" />\n              <small class=\"p-invalid\">{{ errors[0] }}</small>\n            </div>\n          </ValidationProvider>\n          <div class=\"forgetpassword-container\">\n            <a href=\"#\" class=\"forget-password\">忘记密码?</a>\n          </div>\n          <div>\n            <Button type=\"submit\" label=\"登录\" />\n          </div>\n        </form>\n      </ValidationObserver>\n    </div>\n  </body>\n</template>\n\n<script>\nimport VueRouter from 'vue-router'\nimport Logo from '@/components/Logo/index.vue'\nimport settings from '@/settings'\nimport { ValidationObserver, ValidationProvider } from 'vee-validate'\n\nconst { isNavigationFailure, NavigationFailureType } = VueRouter\n\nexport default {\n  name: 'Login',\n  components: {\n    Logo,\n    ValidationObserver,\n    ValidationProvider\n  },\n  data() {\n    this.settings = settings\n    return {\n      loginForm: {\n        username: 'admin',\n        password: '111111'\n      },\n      passwordType: 'password',\n      capsTooltip: false,\n      loading: false,\n      showDialog: false,\n      redirect: undefined,\n      otherQuery: {}\n    }\n  },\n  watch: {\n    $route: {\n      handler: function (route) {\n        const query = route.query\n        if (query) {\n          this.redirect = query.redirect\n          this.otherQuery = this.getOtherQuery(query)\n        }\n      },\n      immediate: true\n    }\n  },\n  created() {\n    // window.addEventListener('storage', this.afterQRScan)\n  },\n  mounted() {\n    if (this.loginForm.username === '') {\n      this.$refs.username.focus()\n    } else if (this.loginForm.password === '') {\n      this.$refs.password.focus()\n    }\n  },\n  unmounted() {\n    // window.removeEventListener('storage', this.afterQRScan)\n  },\n  methods: {\n    checkCapslock(e) {\n      const { key } = e\n      this.capsTooltip = key && key.length === 1 && (key >= 'A' && key <= 'Z')\n    },\n    showPwd() {\n      if (this.passwordType === 'password') {\n        this.passwordType = ''\n      } else {\n        this.passwordType = 'password'\n      }\n      this.$nextTick(() => {\n        this.$refs.password.focus()\n      })\n    },\n    handleLogin() {\n      this.loading = true\n      this.$store.dispatch('user/login', this.loginForm)\n        .then(() => {\n          this.$router.push({ path: this.redirect || '/', query: this.otherQuery }).catch((e) => {\n            if (!isNavigationFailure(e, NavigationFailureType.redirected)) {\n              Promise.reject(e)\n            }\n          })\n          this.loading = false\n        })\n        .catch(() => {\n          this.loading = false\n        })\n    },\n    getOtherQuery(query) {\n      return Object.keys(query).reduce((acc, cur) => {\n        if (cur !== 'redirect') {\n          acc[cur] = query[cur]\n        }\n        return acc\n      }, {})\n    }\n    // afterQRScan() {\n    //   if (e.key === 'x-admin-oauth-code') {\n    //     const code = getQueryObject(e.newValue)\n    //     const codeMap = {\n    //       wechat: 'code',\n    //       tencent: 'code'\n    //     }\n    //     const type = codeMap[this.auth_type]\n    //     const codeName = code[type]\n    //     if (codeName) {\n    //       this.$store.dispatch('LoginByThirdparty', codeName).then(() => {\n    //         this.$router.push({ path: this.redirect || '/' })\n    //       })\n    //     } else {\n    //       alert('第三方登录失败')\n    //     }\n    //   }\n    // }\n  }\n}\n</script>\n\n<style scoped>\n</style>\n"],"names":["isNavigationFailure","NavigationFailureType","VueRouter","_sfc_main","Logo","ValidationObserver","ValidationProvider","settings","route","query","key","acc","cur"],"mappings":"oTA8CA,KAAA,CAAA,oBAAAA,EAAA,sBAAAC,CAAA,EAAAC,EAEAC,EAAA,CACA,KAAA,QACA,WAAA,CACA,KAAAC,EACA,mBAAAC,EACA,mBAAAC,CACA,EACA,MAAA,CACA,YAAA,SAAAC,EACA,CACA,UAAA,CACA,SAAA,QACA,SAAA,QACA,EACA,aAAA,WACA,YAAA,GACA,QAAA,GACA,WAAA,GACA,SAAA,OACA,WAAA,CAAA,CACA,CACA,EACA,MAAA,CACA,OAAA,CACA,QAAA,SAAAC,EAAA,CACA,MAAAC,EAAAD,EAAA,MACAC,IACA,KAAA,SAAAA,EAAA,SACA,KAAA,WAAA,KAAA,cAAAA,CAAA,EAEA,EACA,UAAA,EACA,CACA,EACA,SAAA,CAEA,EACA,SAAA,CACA,KAAA,UAAA,WAAA,GACA,KAAA,MAAA,SAAA,MAAA,EACA,KAAA,UAAA,WAAA,IACA,KAAA,MAAA,SAAA,MAAA,CAEA,EACA,WAAA,CAEA,EACA,QAAA,CACA,cAAA,EAAA,CACA,KAAA,CAAA,IAAAC,CAAA,EAAA,EACA,KAAA,YAAAA,GAAAA,EAAA,SAAA,GAAAA,GAAA,KAAAA,GAAA,GACA,EACA,SAAA,CACA,KAAA,eAAA,WACA,KAAA,aAAA,GAEA,KAAA,aAAA,WAEA,KAAA,UAAA,IAAA,CACA,KAAA,MAAA,SAAA,MAAA,CACA,CAAA,CACA,EACA,aAAA,CACA,KAAA,QAAA,GACA,KAAA,OAAA,SAAA,aAAA,KAAA,SAAA,EACA,KAAA,IAAA,CACA,KAAA,QAAA,KAAA,CAAA,KAAA,KAAA,UAAA,IAAA,MAAA,KAAA,UAAA,CAAA,EAAA,MAAA,GAAA,CACAV,EAAA,EAAAC,EAAA,UAAA,GACA,QAAA,OAAA,CAAA,CAEA,CAAA,EACA,KAAA,QAAA,EACA,CAAA,EACA,MAAA,IAAA,CACA,KAAA,QAAA,EACA,CAAA,CACA,EACA,cAAAQ,EAAA,CACA,OAAA,OAAA,KAAAA,CAAA,EAAA,OAAA,CAAAE,EAAAC,KACAA,IAAA,aACAD,EAAAC,CAAA,EAAAH,EAAAG,CAAA,GAEAD,GACA,EAAA,CACA,CAmBA,CACA"}