{"version":3,"file":"Login-legacy-DKxM8O3x.js","sources":["../../src/views/pages/Login.vue"],"sourcesContent":["<template>\n  <body class=\"login-body\">\n    <div class=\"mobile-banner\">\n      <Logo label=\"\" style=\"height: 48px\" />\n    </div>\n    <div class=\"login-panel\">\n      <Logo label=\"\" style=\"height: 48px\" />\n    </div>\n    <div class=\"login-card\">\n      <div class=\"top-border\" />\n      <ValidationObserver ref=\"observer\" v-slot=\"{ handleSubmit }\">\n        <form @submit.prevent=\"handleSubmit(handleLogin)\" class=\"login-content\">\n          <h1>登录</h1>\n          <p>欢迎使用{{ settings.title }}系统</p>\n          <ValidationProvider tag=\"div\" rules=\"required\" name=\"loginForm.username\" class=\"username-container\" v-slot=\"{ errors }\">\n            <label>用户名</label>\n            <div class=\"login-input\">\n              <InputText v-model=\"loginForm.username\" placeholder=\"请输入用户名\" />\n              <small class=\"p-invalid\">{{ errors[0] }}</small>\n            </div>\n          </ValidationProvider>\n          <ValidationProvider tag=\"div\" rules=\"required\" name=\"loginForm.password\" class=\"password-container\" v-slot=\"{ errors }\" >\n            <label>密码</label>\n            <div class=\"login-input\">\n              <InputText v-model=\"loginForm.password\" type=\"password\" placeholder=\"请输入密码\" />\n              <small class=\"p-invalid\">{{ errors[0] }}</small>\n            </div>\n          </ValidationProvider>\n          <div class=\"forgetpassword-container\">\n            <a href=\"#\" class=\"forget-password\">忘记密码?</a>\n          </div>\n          <div>\n            <Button type=\"submit\" label=\"登录\" />\n          </div>\n        </form>\n      </ValidationObserver>\n    </div>\n  </body>\n</template>\n\n<script>\nimport VueRouter from 'vue-router'\nimport Logo from '@/components/Logo/index.vue'\nimport settings from '@/settings'\nimport { ValidationObserver, ValidationProvider } from 'vee-validate'\n\nconst { isNavigationFailure, NavigationFailureType } = VueRouter\n\nexport default {\n  name: 'Login',\n  components: {\n    Logo,\n    ValidationObserver,\n    ValidationProvider\n  },\n  data() {\n    this.settings = settings\n    return {\n      loginForm: {\n        username: 'admin',\n        password: '111111'\n      },\n      passwordType: 'password',\n      capsTooltip: false,\n      loading: false,\n      showDialog: false,\n      redirect: undefined,\n      otherQuery: {}\n    }\n  },\n  watch: {\n    $route: {\n      handler: function (route) {\n        const query = route.query\n        if (query) {\n          this.redirect = query.redirect\n          this.otherQuery = this.getOtherQuery(query)\n        }\n      },\n      immediate: true\n    }\n  },\n  created() {\n    // window.addEventListener('storage', this.afterQRScan)\n  },\n  mounted() {\n    if (this.loginForm.username === '') {\n      this.$refs.username.focus()\n    } else if (this.loginForm.password === '') {\n      this.$refs.password.focus()\n    }\n  },\n  unmounted() {\n    // window.removeEventListener('storage', this.afterQRScan)\n  },\n  methods: {\n    checkCapslock(e) {\n      const { key } = e\n      this.capsTooltip = key && key.length === 1 && (key >= 'A' && key <= 'Z')\n    },\n    showPwd() {\n      if (this.passwordType === 'password') {\n        this.passwordType = ''\n      } else {\n        this.passwordType = 'password'\n      }\n      this.$nextTick(() => {\n        this.$refs.password.focus()\n      })\n    },\n    handleLogin() {\n      this.loading = true\n      this.$store.dispatch('user/login', this.loginForm)\n        .then(() => {\n          this.$router.push({ path: this.redirect || '/', query: this.otherQuery }).catch((e) => {\n            if (!isNavigationFailure(e, NavigationFailureType.redirected)) {\n              Promise.reject(e)\n            }\n          })\n          this.loading = false\n        })\n        .catch(() => {\n          this.loading = false\n        })\n    },\n    getOtherQuery(query) {\n      return Object.keys(query).reduce((acc, cur) => {\n        if (cur !== 'redirect') {\n          acc[cur] = query[cur]\n        }\n        return acc\n      }, {})\n    }\n    // afterQRScan() {\n    //   if (e.key === 'x-admin-oauth-code') {\n    //     const code = getQueryObject(e.newValue)\n    //     const codeMap = {\n    //       wechat: 'code',\n    //       tencent: 'code'\n    //     }\n    //     const type = codeMap[this.auth_type]\n    //     const codeName = code[type]\n    //     if (codeName) {\n    //       this.$store.dispatch('LoginByThirdparty', codeName).then(() => {\n    //         this.$router.push({ path: this.redirect || '/' })\n    //       })\n    //     } else {\n    //       alert('第三方登录失败')\n    //     }\n    //   }\n    // }\n  }\n}\n</script>\n\n<style scoped>\n</style>\n"],"names":["_VueRouter$","VueRouter","isNavigationFailure","NavigationFailureType","name","components","Logo","ValidationObserver","ValidationProvider","data","this","settings","loginForm","username","password","passwordType","capsTooltip","loading","showDialog","redirect","undefined","otherQuery","watch","$route","handler","route","query","getOtherQuery","immediate","created","mounted","$refs","focus","unmounted","methods","checkCapslock","e","key","length","showPwd","_this","$nextTick","handleLogin","_this2","$store","dispatch","then","$router","push","path","catch","redirected","Promise","reject","Object","keys","reduce","acc","cur"],"mappings":"whBA8CA,IAAAA,EAAAC,EAAAC,EAAAF,EAAAE,oBAAAC,EAAAH,EAAAG,oCAEA,CACAC,KAAA,QACAC,WAAA,CACAC,KAAAA,EACAC,mBAAAA,EACAC,mBAAAA,GAEAC,KAAAA,WAEA,OADAC,KAAAC,SAAAA,EACA,CACAC,UAAA,CACAC,SAAA,QACAC,SAAA,UAEAC,aAAA,WACAC,aAAA,EACAC,SAAA,EACAC,YAAA,EACAC,cAAAC,EACAC,WAAA,CAAA,EAEA,EACAC,MAAA,CACAC,OAAA,CACAC,QAAA,SAAAC,GACA,IAAAC,EAAAD,EAAAC,MACAA,IACAhB,KAAAS,SAAAO,EAAAP,SACAT,KAAAW,WAAAX,KAAAiB,cAAAD,GAEA,EACAE,WAAA,IAGAC,QAAAA,WACA,EAEAC,QAAA,WACA,KAAApB,KAAAE,UAAAC,SACAH,KAAAqB,MAAAlB,SAAAmB,QACA,KAAAtB,KAAAE,UAAAE,UACAJ,KAAAqB,MAAAjB,SAAAkB,OAEA,EACAC,UAAA,WACA,EAEAC,QAAA,CACAC,cAAAA,SAAAC,GACA,IAAAC,EAAAD,EAAAC,IACA3B,KAAAM,YAAAqB,GAAA,IAAAA,EAAAC,QAAAD,GAAA,KAAAA,GAAA,GACA,EACAE,QAAAA,WAAA,IAAAC,EAAA9B,KACA,aAAAA,KAAAK,aACAL,KAAAK,aAAA,GAEAL,KAAAK,aAAA,WAEAL,KAAA+B,WAAA,WACAD,EAAAT,MAAAjB,SAAAkB,OACA,GACA,EACAU,YAAA,WAAAC,IAAAA,EACAjC,KAAAA,KAAAO,SAAA,EACAP,KAAAkC,OAAAC,SAAA,aAAAnC,KAAAE,WACAkC,MAAA,WACAH,EAAAI,QAAAC,KAAA,CAAAC,KAAAN,EAAAxB,UAAA,IAAAO,MAAAiB,EAAAtB,aAAA6B,OAAA,SAAAd,GACAlC,EAAAkC,EAAAjC,EAAAgD,aACAC,QAAAC,OAAAjB,EAEA,IACAO,EAAA1B,SAAA,CACA,IACAiC,OAAA,WACAP,EAAA1B,SAAA,CACA,GACA,EACAU,cAAA,SAAAD,GACA,OAAA4B,OAAAC,KAAA7B,GAAA8B,QAAA,SAAAC,EAAAC,GAIA,MAHA,aAAAA,IACAD,EAAAC,GAAAhC,EAAAgC,IAEAD,CACA,GAAA,GACA"}